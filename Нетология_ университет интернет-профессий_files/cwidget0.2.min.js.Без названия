window.ODW=function(obj)
{this.g_url='https://omnidesk.ru';this.g_iframe_button_id='omni_widget_iframe',this.g_iframe_widget_id='omni_widget_iframe_widget',this.g_config={},this.config_widget=null,this.email_widget=null,this.widget={},this.g_iframe_button=null,this.g_iframe_widget=null,this.type_widget=null,this.b_send=!1;this.help_size={};this.btn_inited=!1;this.btn_prev_w=0;this.btn_prev_h=0;this.b_rendered_button=!1;this.yaCounterId=!1;for(var j in obj){this[j]=obj[j]}
var self=this;this.PreLoad=function(){if(window._g_omni_global_url)
{self.g_url=window._g_omni_global_url}
self.g_config.diplay_button=!0;self.g_config.user_info=!1;if(!self.g_config.widget_id){console.log('err; not found widget_id');return!1}
self.g_iframe_button_id+='_'+self.g_config.widget_id;self.g_iframe_widget_id+='_'+self.g_config.widget_id;if(self.g_config.user)
{for(var j in self.g_config.user){self.g_config[j]=self.g_config.user[j]}
delete(self.g_config.user)}
if(self.email_widget)
{self.type_widget='email'}
var tmp_interval=setInterval(function(){self.LoadWidgetData();clearInterval(tmp_interval)},10)}();this.Ready=function()
{if(self.email_widget.readyQueue[0])
{self.email_widget.readyQueue[0]()}
self.yaCounterId=self.g_config.yaCounterId||self.GetYaCounterId();if(self.widget&&self.widget.ready)
{self.widget.ready()}
var set_widget_onclick=function(el,obj)
{for(j in el)
{if(el[j])
{el[j].onclick=function()
{if(obj.config_widget.type.match(/messengers/))
{window.frames[obj.g_iframe_button_id+'_name'].postMessage('show_widget',self.g_url)}
else{obj.RenderWidget()}
return!1}}}};set_widget_onclick(document.getElementsByClassName('omni-email-widget'),self);var k=0;for(var kk in window.omni)
{var tmp_wid=window.omni[kk]&&window.omni[kk].g_config?window.omni[kk].g_config.widget_id.match(/^[0-9]+/)[0]:!1;if(window.cOmni[tmp_wid])
{set_widget_onclick(document.getElementsByClassName('omni-email-widget_'+k),window.cOmni[tmp_wid]);k++}}
tmp_style=document.createElement('style');tmp_style.innerHTML='.omni-widget-expanded {overflow: hidden !important;height: 100% !important;width: 100% !important;position: fixed !important;margin: 0 !important;top: 0 !important;left: 0 !important;}';var head=document.getElementsByTagName("head")[0];head.appendChild(tmp_style,head);setTimeout(function()
{if(!self.btn_inited&&self.g_config.diplay_button)
{self.RenderButton()}},500);window.frames[self.g_iframe_button_id+'_name'].postMessage(self.ObjToStr({'act':'set_location','location':window.location.href}),self.g_url)},this.LoadWidgetData=function()
{var body=document.getElementsByTagName("body")[0];self.g_iframe_button=document.createElement('iframe');self.g_iframe_button.id=self.g_iframe_button_id;self.g_iframe_button.name=self.g_iframe_button_id+'_name';self.g_iframe_button.scrolling="no";self.g_iframe_button.style.position='absolute';self.g_iframe_button.style.top='-1000px';self.g_iframe_button.style.left='-1234px';self.g_iframe_button.style.width='500px';self.g_iframe_button.style.height='500px';self.g_iframe_button.target='_top';self.g_iframe_button.src=self.g_url+'/client_widgets/init/'+self.g_config.widget_id+'?btn_hide='+(self.g_config.diplay_button?0:1);body.appendChild(self.g_iframe_button,body);self.g_iframe_widget=document.createElement('iframe');self.g_iframe_widget.id=self.g_iframe_widget_id;self.g_iframe_widget.name=self.g_iframe_widget_id+'_name';self.g_iframe_widget.style.position='absolute';self.g_iframe_widget.style.top='-4000px';self.g_iframe_widget.style.left='-4000px';self.g_iframe_widget.style.width=document.body.clientWidth+'px';self.g_iframe_widget.style.height=document.body.clientHeight+'px';if(!self.g_config.diplay_button){var body=document.getElementsByTagName("body")[0];self.g_iframe_widget.src=self.g_url+'/client_widgets/widget/'+self.g_config.widget_id;body.appendChild(self.g_iframe_widget,body)}},this.RenderButton=function(btn_type,params)
{if(!self.config_widget)
return!1;self.btn_inited=!0;var settings=self.config_widget.settings;if(!btn_type)
{btn_type=settings.button_type}
if(!params)
{params={}}
var css={'background':'transparent','position':'fixed','z-index':'2000','top':'auto',};if(self.g_iframe_button.style.left=='-1234px')
{css.left='auto'}
this.removeClass(document.getElementsByTagName('body')[0],'omni-widget-expanded');this.removeClass(document.getElementsByTagName('html')[0],'omni-widget-expanded');if(btn_type=='resize')
{if(params.b_full_screen)
{self.btn_prev_w=parseInt(self.g_iframe_button.style.width);self.btn_prev_h=parseInt(self.g_iframe_button.style.height);this.addClass(document.getElementsByTagName('body')[0],'omni-widget-expanded');this.addClass(document.getElementsByTagName('html')[0],'omni-widget-expanded');css.position='fixed';css.left='0px';css.top='0px';css.bottom='0px';css.right='0px';css.width=window.innerWidth+'px';css.height=window.innerHeight+'px'}
else if(params.b_exit_full_screen)
{css.width=self.btn_prev_w+'px';css.height=self.btn_prev_h+'px';css.left='';css.right='';css[settings.button_position]='25px';css.bottom='25px'}
else{css.width=parseInt(params.nw)+'px';css.height=parseInt(params.nh)+'px'}
if(params.bottom)
css.bottom=parseInt(params.bottom)+'px'}
else if(btn_type=='messengers')
{var ico_margin_b=0;var ico_margin_b_last=0;switch(settings.ico_size_pixels)
{case 36:ico_margin_b=6;ico_margin_b_last=12;break;case 42:ico_margin_b=8;ico_margin_b_last=16;break;case 50:ico_margin_b=10;ico_margin_b_last=20;break}
css[settings.button_position]='25px';css.bottom='0px';css.width=(settings.ico_size_pixels)+'px';css.height=((settings.ico_size_pixels+ico_margin_b)*(self.config_widget.channels_cnt-1)+(settings.ico_size_pixels+ico_margin_b_last)+settings.ico_size_pixels+24)+'px'}
else if(btn_type=='square')
{css[settings.button_position]=self.config_widget.type.match(/messengers/)?'25px':'20px';css.bottom=self.config_widget.type.match(/messengers/)?'25px':'20px';css.width=(settings.ico_size_pixels+(params.help_w?parseInt(params.help_w):0))+'px';css.height=((params.help_h?parseInt(params.help_h):settings.ico_size_pixels))+'px'}
else if(btn_type=='line'&&(settings.button_position=='bottom_left'||settings.button_position=='bottom_right'))
{css[settings.button_position.substr(7)]='20px';css.bottom='0px';if(self.g_config.width_button)
{css.width=self.g_config.width_button}
else{css['min-width']='300px';css['max-width']='380px'}
css.height='36px'}
else if(btn_type=='line'&&(settings.button_position=='left'||settings.button_position=='right'))
{css[settings.button_position]='0px';css.top='50%';css.width='36px';css.height=self.g_config.width_button?self.g_config.width_button+'px':'180px';css['margin-top']=self.g_config.width_button?'-'+(self.g_config.width_button/2)+'px':'-90px'}
css['max-width']='100%';if(!self.b_rendered_button)
{css.display='none';setTimeout(function(){self.setCss(self.g_iframe_button,css);self.g_iframe_button.style.border='none';self.b_rendered_button=!0},100);setTimeout(function(){self.Show(self.g_iframe_button)},300)}
this.setCss(self.g_iframe_button,css);self.g_iframe_button.style.border='none'},this.RenderWidget=function()
{var css_arr={'background':'transparent','border':'none','position':'fixed','z-index':'2000','width':'100%','height':'100%','top':'0px','bottom':'0px','left':'0px','right':'0px','margin_top':'0px'};var body=document.getElementsByTagName("body")[0];body.style.cssText="overflow-y: hidden";var new_this=this;setTimeout(function(){new_this.setCss(self.g_iframe_widget,css_arr);new_this.Show(self.g_iframe_widget)},700);window.frames[self.g_iframe_widget_id+'_name'].postMessage('update_content_field',self.g_url);setTimeout(function()
{self.g_iframe_widget.contentWindow.focus();self.g_iframe_widget.focus()},1000)},this.CloseWidget=function(){var body=document.getElementsByTagName("body")[0];body.style.cssText="overflow-y: auto";this.Hide(self.g_iframe_widget);if(self.b_send)
{self.g_iframe_widget.src=self.g_url+'/client_widgets/widget/'+self.g_config.widget_id;self.b_send=!1}};this.listen_iframe=function(e){var self_=self;if(e.data&&e.origin.match(/facebook\.com/))
{if(typeof e.data=='string'&&e.data.match(/liveChatPluginHideDialogIframe|liveChatPluginShowDialogIframe/))
{this.setCss(document.querySelectorAll('#omni_fb_community_messages iframe')[0],{'max-height':'0px'});this.Hide(document.querySelectorAll('#omni_fb_community_messages iframe')[0]);this.Show(self.g_iframe_button)}}
if(e.data&&e.origin.match(/chat\.chatra\.io/))
{if(typeof e.data=='string'&&e.data.match(/\"type\":\"collapseWindow\",/))
{this.Hide(document.querySelectorAll('div#chatra')[0]);this.Show(self.g_iframe_button)}
else if(typeof e.data=='string'&&(e.data.match(/:\"titleBlink\",\"data\":\"Новое сообщение /)||e.data.match(/\"type\":\"transparentChatHeight\"/)))
{Chatra('openChat',window);this.Show(document.querySelectorAll('div#chatra')[0]);Chatra('show');this.Hide(self.g_iframe_button)}
else if(typeof e.data=='string'&&e.data.match(/{\"type\":\"showChat\"/))
{window.frames[self_.g_iframe_button_id+'_name'].postMessage('chatra_show',self_.g_url)}
else if(typeof e.data=='string'&&e.data.match(/{\"type\":\"hideChat\"/))
{window.frames[self_.g_iframe_button_id+'_name'].postMessage('chatra_hide',self_.g_url)}}
else if(e.data&&e.origin==self_.g_url)
{data=e.data;if(typeof data==='string')
{if(!data.match(/^\{/)||!data.match(/\}$/))
{return!1}
data=data.replace(/\n/g,' ');data=JSON.parse(data)}
var tmp_widget_id=parseInt(data.widget_id);self_=cOmni[tmp_widget_id];if(data.act&&data.act=='change_channels_cnt')
{self.config_widget.channels_cnt=data.channels_cnt}
else if(data.act&&data.act=='yaReachGoal')
{self_.YaReachGoal(data.target)}
else if(data.act&&data.act=='fb_chat_open')
{this.Show(document.getElementById('fb-root'));this.Show(document.querySelectorAll('#omni_fb_community_messages iframe')[0]);this.setCss(document.querySelectorAll('#omni_fb_community_messages iframe')[0],{'max-height':'100%'});document.querySelectorAll('#omni_fb_community_messages iframe')[0].setAttribute('class','fb_customer_chat_bounce_in');this.Hide(self.g_iframe_button)}
else if(data.act&&data.act=='init_fb_chat')
{window.fbAsyncInit=function(){FB.init({xfbml:!0,version:'v3.2'})};button_position=self_.config_widget.settings.button_position;tmp_div=document.createElement('div');tmp_div.setAttribute('id','omni_fb_community_messages');tmp_div.setAttribute('class','fb-customerchat');tmp_div.setAttribute('page_id',data.fb_page_id);tmp_div.setAttribute('minimized','true');var body=document.getElementsByTagName("body")[0];body.appendChild(tmp_div,body);tmp_style=document.createElement('style');tmp_style.innerHTML='div#fb-root {display:none; z-index:2001}'+'div#fb-root .fb_dialog{display: none !important;}'+'#omni_fb_community_messages iframe {bottom: 25px !important; '+(button_position=='right'?'right: 25px !important':'left:25px;right: 0px !important')+';border-bottom-left-radius: 0 !important;border-bottom-right-radius: 0 !important;height: 399px !important;overflow: hidden !important;display: none;box-shadow: 0 0 0 0; !important; display none !important}';var head=document.getElementsByTagName("head")[0];head.appendChild(tmp_style,head);var s=document.createElement("script");s.type="text/javascript";s.async=!0;s.src=(document.location.protocol==='https:'?'https:':'http:')+'//connect.facebook.net/en_US/sdk/xfbml.customerchat.js';var body=document.getElementsByTagName("body")[0];body.parentNode.appendChild(s,body)}
else if(data.act&&data.act=='chatra_chat_open')
{if(window.Chatra)
{button_position=self_.config_widget.settings.button_position;cls_list=document.querySelectorAll('div#chatra')[0].className;cls_list=cls_list.replace(/chatra--pos-right/,'').replace(/chatra--pos-left/,'')+' '+(button_position=='right'?'chatra--pos-right':'chatra--pos-left');document.querySelectorAll('div#chatra')[0].setAttribute('class',cls_list);if(button_position=='left')
{this.setCss(document.querySelectorAll('div#chatra')[0],{'left':'25px'})}
Chatra('openChat',window);this.Show(document.querySelectorAll('div#chatra')[0]);Chatra('show');this.Hide(self.g_iframe_button)}}
else if(data.act&&data.act=='init_chatra_chat')
{window.ChatraSetup={startHidden:!0,};if(data.chatra_group&&data.chatra_group.length>1)
{window.ChatraSetup.groupId=data.chatra_group}(function(d,w,c)
{w.ChatraID=data.chat_key;var s=d.createElement('script');w[c]=w[c]||function()
{(w[c].q=w[c].q||[]).push(arguments)};s.async=!0;s.src=(d.location.protocol==='https:'?'https:':'http:')+'//call.chatra.io/chatra.js';if(d.head)d.head.appendChild(s)})(document,window,'Chatra');Chatra('setIntegrationData',data.chatra_i_data);setTimeout(function(){if(Chatra._chatHiddenByFrame)
{window.frames[self_.g_iframe_button_id+'_name'].postMessage('chatra_hide',self_.g_url)}},500)}
else if(data.act&&data.act=='link_click')
{if(!document.getElementById('omni_hidden_mlink'))
{var body=document.getElementsByTagName("body")[0];var tmp_a=document.createElement('a');tmp_a.id='omni_hidden_mlink';tmp_a.target='_blank';body.appendChild(tmp_a,body)}
document.getElementById('omni_hidden_mlink').href=data.href;document.getElementById('omni_hidden_mlink').click()}
else if(data.act&&data.act=='btn_resize')
{self_.RenderButton('resize',data)}
else if(data.act&&data.act=='show_help')
{if(data.help_w)
{self_.help_size=data}
else{window.frames[self_.g_iframe_button_id+'_name'].postMessage('show_help',self_.g_url)}
self_.RenderButton(0,self_.help_size)}
else if(data.act&&(data.act=='messenger_close'||data.act=='update_size_btn'))
{self_.RenderButton()}
else if(data.act&&data.act=='init_widget')
{if(self_.config_widget.type.match(/messengers/)&&!data.b_open_widget)
{self_.RenderButton('messengers');return}
else{self_.RenderButton()}
self_.RenderWidget();if(self_.config_widget.type=="knowledge_mail"&&self_.config_widget.settings.knowledge_type=="search")
{window.frames[self_.g_iframe_widget_id+'_name'].postMessage('focus_search',self_.g_url)}
if(self_.config_widget.type=="mail")
{window.frames[self_.g_iframe_widget_id+'_name'].postMessage('update_form',self_.g_url)}}
else if(data.act&&data.act=='resize_button')
{self_.g_config.width_button=data.value}
else if(data.act&&data.act=='close_widget')
{return self_.CloseWidget()}
else if(data.act&&data.act=='success_send')
{self_.b_send=!0}
else if(data.act&&data.act=='loaded_widget')
{if(self_.type_widget&&self_.type_widget=='email')
{var params={'user_info':self_.g_config.user_info?{'location':window.location.href,'ua':navigator.userAgent}:!1,'identify':self_.email_widget.identify||self_.widget.identify||null,'case_subject':self_.email_widget.case_subject||self_.widget.case_subject||null,'search_str':self_.email_widget.search||self_.widget.search||null,};window.frames[self_.g_iframe_widget_id+'_name'].postMessage(self_.ObjToStr(params),self_.g_url)}}
else if(data.act&&data.act=='loaded_btn')
{params={'user_info':self_.g_config.user_info?{'location':window.location.href,'ua':navigator.userAgent}:!1,'identify':self_.email_widget.identify||self_.widget.identify||null,};window.frames[self_.g_iframe_button_id+'_name'].postMessage(self_.ObjToStr(params),self_.g_url)}
else if(data.widget_id&&!self_.config_widget)
{if(data.type!="messengers"&&self_.g_config.diplay_button)
{var body=document.getElementsByTagName("body")[0];self_.g_iframe_widget.src=self_.g_url+'/client_widgets/widget/'+self_.g_config.widget_id;body.appendChild(self_.g_iframe_widget,body)}
self_.config_widget=data;self_.Ready()}}},this.ObjToStr=function(o,quotes){quotes=quotes?quotes:'"';var parse=function(_o,_quotes){var a=[],t;for(var p in _o){if(_o.hasOwnProperty(p)){t=_o[p];if(t&&typeof t=="object")
{a[a.length]=_quotes+p+_quotes+":{ "+arguments.callee(t,_quotes).join(", ")+"}"}
else{if(typeof t=="string"){a[a.length]=[_quotes+p+_quotes+": "+_quotes+encodeURIComponent(t.toString())+_quotes]}
else if(t){a[a.length]=[_quotes+p+_quotes+": "+t.toString()]}}}}
return a};return "{"+parse(o,quotes).join(", ")+"}"};this.setCss=function(element,arr){var css_arr=[];var current_style=element.style.cssText;var styles_arr=current_style.trim().split(';');var tmp_style;var w=null;var h=null;var css_string='';for(var row in styles_arr){if(typeof styles_arr[row]=='string')
{styles_arr[row]=styles_arr[row].trim();if(styles_arr[row].length!=0)
{tmp_style=styles_arr[row].split(':');css_arr[tmp_style[0]]=tmp_style[1]}}}
for(style in arr){css_arr[style]=arr[style]}
for(elem in css_arr){css_string=css_string+elem+': '+css_arr[elem]+'; '}
element.style.cssText=css_string};this.addClass=function(element,name){arr=element.className.split(" ");if(arr.indexOf(name)==-1){element.className=(element.className+" "+name).trim()}};this.removeClass=function(element,name)
{element.className=element.className.replace(new RegExp(name,'g'),"").trim()};this.Show=function(element){this.setCss(element,{'display':'block'})};this.Hide=function(element){this.setCss(element,{'display':'none'})};this.GetYaCounterId=function(){var id=null;for(var i in window){if(i.match(/^yaCounter([0-9]+)/)){id=i.match(/^yaCounter([0-9]+)/)[1];break}}
return id};this.YaReachGoal=function(target_name){if(!this.yaCounterId){return!1}
if(window.ym)
{ym(this.yaCounterId,'reachGoal',target_name);return!0}
else if(window['yaCounter'+this.yaCounterId])
{window['yaCounter'+this.yaCounterId].reachGoal(target_name);return!0}
return!1}};var OmniWidgetApi={call:function(str){str=str.split('.');var tmp=Object.keys(cOmni);var cW=str[1]&&cOmni[str[1]]?cOmni[str[1]]:cOmni[tmp[0]]
var key=str[0];if(key=='get_list')
{var tmp=Object.keys(cOmni);console.log('Widget id         Widget title');for(var i in tmp)
{console.log(tmp[i]+(new Array(19-tmp[i].toString().length).join(' '))+cOmni[tmp[i]].config_widget.title)}}
else if(key=='open')
{window.frames[cW.g_iframe_button_id+'_name'].postMessage('gOmniListShow',cW.g_url)}
else if(key=='close')
{window.frames[cW.g_iframe_button_id+'_name'].postMessage('gOmniListHide',cW.g_url)}
else if(key=='open_widget')
{cW.RenderWidget()}
else if(key=='close_widget')
{cW.CloseWidget()}
else if(key=='hide_btn')
{cW.Hide(cW.g_iframe_button)}
else if(key=='show_btn')
{cW.Show(cW.g_iframe_button)}}}
!function(){if(window.b_omni_loaded)return;window.b_omni_loaded=!0;window.cOmni={};if(omni.g_config){omni=[omni]}
for(var j in omni){if(j.match(/^[0-9]+$/)){cClass=cOmni[omni[j].g_config.widget_id.match(/^[0-9]+/).toString()]=new ODW(omni[j])}}
if(typeof window.addEventListener!='undefined')
window.addEventListener('message',function(e){cClass.listen_iframe(e)},!1);else if(typeof window.attachEvent!='undefined')
window.attachEvent('onmessage',function(e){cClass.listen_iframe(e)})}()